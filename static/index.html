<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scopus Search API v3.0</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        
        .header-subtitle {
            font-size: 1.1em;
            opacity: 0.9;
            margin-bottom: 15px;
        }
        
        .user-badge {
            background: rgba(255,255,255,0.2);
            padding: 10px 20px;
            border-radius: 25px;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            backdrop-filter: blur(10px);
        }
        
        .auth-box {
            background: white;
            border-radius: 15px;
            padding: 40px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            max-width: 450px;
            margin: 0 auto;
        }
        
        .auth-box h2 {
            text-align: center;
            margin-bottom: 30px;
            color: #333;
        }
        
        .tab-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
        }
        
        .tab-btn {
            flex: 1;
            padding: 12px;
            border: none;
            background: #f0f0f0;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .tab-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .nav-bar {
            background: white;
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        
        .nav-item {
            padding: 12px 24px;
            border: none;
            background: #f0f0f0;
            border-radius: 8px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .nav-item.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }
        
        .card-title {
            margin-bottom: 20px;
            color: #333;
            font-size: 1.5em;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
        }
        
        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
            font-family: inherit;
        }
        
        .form-control:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        
        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102,126,234,0.4);
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        
        .btn-sm {
            padding: 8px 16px;
            font-size: 14px;
        }
        
        .paper-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            border: 2px solid #e0e0e0;
            transition: all 0.3s;
        }
        
        .paper-card:hover {
            border-color: #667eea;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .paper-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
            line-height: 1.4;
        }
        
        .paper-meta {
            color: #666;
            font-size: 14px;
            margin-bottom: 10px;
        }
        
        .paper-meta span {
            margin-right: 15px;
            display: inline-block;
        }
        
        .paper-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: 500;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }
        
        .list-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
        }
        
        .list-item:hover {
            background: #e9ecef;
        }
        
        .list-item-content {
            flex: 1;
        }
        
        .list-item-title {
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .list-item-meta {
            font-size: 14px;
            color: #666;
        }
        
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
        }
        
        .badge-success {
            background: #d4edda;
            color: #155724;
        }
        
        .badge-secondary {
            background: #e2e3e5;
            color: #383d41;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }
        
        .empty-state-icon {
            font-size: 4em;
            margin-bottom: 20px;
        }
        
        .empty-state-text {
            font-size: 1.2em;
            margin-bottom: 10px;
        }
        
        .fade-enter-active, .fade-leave-active {
            transition: opacity 0.3s;
        }
        
        .fade-enter-from, .fade-leave-to {
            opacity: 0;
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2em;
            }
            .card {
                padding: 20px;
            }
            .auth-box {
                padding: 30px 20px;
            }
        }
    </style>
</head>

<body>
    <div id="app">
        <div class="container">
            <div class="header">
                <h1>üî¨ Scopus Search API v3.0</h1>
                <p class="header-subtitle">{{ headerSubtitle }}</p>
                <transition name="fade">
                    <div v-if="isAuthenticated" class="user-badge">
                        <span>üë§ {{ user?.email }}</span>
                        <button @click="logout" class="btn btn-secondary btn-sm">Logout</button>
                    </div>
                </transition>
            </div>

            <transition name="fade">
                <div v-if="!isAuthenticated" class="auth-box">
                    <h2>üîê Authentication</h2>
                    
                    <div class="tab-buttons">
                        <button @click="authTab = 'login'" :class="{ active: authTab === 'login' }" class="tab-btn">
                            Login
                        </button>
                        <button @click="authTab = 'register'" :class="{ active: authTab === 'register' }" class="tab-btn">
                            Register
                        </button>
                    </div>

                    <transition name="fade">
                        <div v-if="authAlert.show" class="alert" :class="'alert-' + authAlert.type">
                            {{ authAlert.message }}
                        </div>
                    </transition>

                    <div v-show="authTab === 'login'">
                        <form @submit.prevent="login">
                            <div class="form-group">
                                <label class="form-label">Email</label>
                                <input type="email" v-model="loginForm.email" class="form-control" placeholder="your@email.com" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Password</label>
                                <input type="password" v-model="loginForm.password" class="form-control" placeholder="Enter password" required>
                            </div>
                            <button type="submit" :disabled="authLoading" class="btn btn-primary" style="width: 100%;">
                                <span v-if="!authLoading">üîì Login</span>
                                <span v-else>Loading...</span>
                            </button>
                        </form>
                    </div>

                    <div v-show="authTab === 'register'">
                        <form @submit.prevent="register">
                            <div class="form-group">
                                <label class="form-label">Email</label>
                                <input type="email" v-model="registerForm.email" class="form-control" placeholder="your@email.com" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Password</label>
                                <input type="password" v-model="registerForm.password" class="form-control" placeholder="Min. 6 characters" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Confirm Password</label>
                                <input type="password" v-model="registerForm.confirmPassword" class="form-control" placeholder="Re-enter password" required>
                            </div>
                            <button type="submit" :disabled="authLoading" class="btn btn-primary" style="width: 100%;">
                                <span v-if="!authLoading">üìù Register</span>
                                <span v-else>Loading...</span>
                            </button>
                        </form>
                    </div>
                </div>
            </transition>

            <transition name="fade">
                <div v-if="isAuthenticated">
                    <div class="nav-bar">
                        <button @click="activeSection = 'search'" :class="{ active: activeSection === 'search' }" class="nav-item">
                            üîç Search
                        </button>
                        <button @click="switchSection('wishlist')" :class="{ active: activeSection === 'wishlist' }" class="nav-item">
                            ‚≠ê Wishlist
                        </button>
                        <button @click="switchSection('apikeys')" :class="{ active: activeSection === 'apikeys' }" class="nav-item">
                            üîë API Keys
                        </button>
                    </div>

                    <div v-show="activeSection === 'search'" class="card">
                        <h3 class="card-title">üîç Search Papers</h3>
                        
                        <transition name="fade">
                            <div v-if="searchAlert.show" class="alert" :class="'alert-' + searchAlert.type">
                                {{ searchAlert.message }}
                            </div>
                        </transition>

                        <form @submit.prevent="searchPapers">
                            <div class="form-group">
                                <label class="form-label">Search Query</label>
                                <input type="text" v-model="searchForm.query" class="form-control" placeholder="e.g., machine learning" required>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Limit</label>
                                    <input type="number" v-model.number="searchForm.limit" class="form-control" min="1" max="1000">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Year From</label>
                                    <input type="number" v-model.number="searchForm.yearFrom" class="form-control" placeholder="e.g., 2020">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Year To</label>
                                    <input type="number" v-model.number="searchForm.yearTo" class="form-control" placeholder="e.g., 2024">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Sort By</label>
                                    <select v-model="searchForm.sortBy" class="form-control">
                                        <option value="-citedby-count">Most Cited</option>
                                        <option value="-date">Newest First</option>
                                        <option value="date">Oldest First</option>
                                        <option value="relevance">Relevance</option>
                                    </select>
                                </div>
                            </div>

                            <button type="submit" :disabled="searchLoading" class="btn btn-primary">
                                <span v-if="!searchLoading">üîç Search</span>
                                <span v-else>Searching...</span>
                            </button>
                            <button type="button" @click="clearSearch" class="btn btn-secondary">üóëÔ∏è Clear</button>
                        </form>

                        <div v-if="searchLoading" class="loading">
                            <div class="spinner"></div>
                            <p>Loading papers...</p>
                        </div>

                        <div v-if="searchResults.length > 0" style="margin-top: 30px;">
                            <h3>Results: {{ searchResults.length }} papers</h3>
                            <div v-for="paper in searchResults" :key="paper.eid" class="paper-card">
                                <div class="paper-title">{{ paper.title }}</div>
                                <div class="paper-meta">
                                    <span>üë§ {{ paper.authors }}</span>
                                    <span>üìÖ {{ paper.year }}</span>
                                    <span>üìñ {{ paper.publication }}</span>
                                    <span>üìä Cited: {{ paper.cited_by }}</span>
                                    <span v-if="paper.open_access" style="color: #28a745;">üîì Open Access</span>
                                </div>
                                <div class="paper-actions">
                                    <button @click="addToWishlist(paper)" class="btn btn-success btn-sm">
                                        ‚≠ê Save to Wishlist
                                    </button>
                                    <a v-if="paper.scopus_url !== 'N/A'" :href="paper.scopus_url" target="_blank" class="btn btn-primary btn-sm">
                                        üîó View on Scopus
                                    </a>
                                    <a v-if="paper.doi !== 'N/A'" :href="'https://doi.org/' + paper.doi" target="_blank" class="btn btn-secondary btn-sm">
                                        üìÑ DOI
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div v-show="activeSection === 'wishlist'" class="card">
                        <h3 class="card-title">‚≠ê My Wishlist</h3>
                        
                        <transition name="fade">
                            <div v-if="wishlistAlert.show" class="alert" :class="'alert-' + wishlistAlert.type">
                                {{ wishlistAlert.message }}
                            </div>
                        </transition>

                        <div v-if="wishlistLoading" class="loading">
                            <div class="spinner"></div>
                            <p>Loading wishlist...</p>
                        </div>

                        <div v-if="!wishlistLoading && wishlist.length === 0" class="empty-state">
                            <div class="empty-state-icon">üìö</div>
                            <div class="empty-state-text">Your wishlist is empty</div>
                            <p>Save papers from search results to see them here</p>
                        </div>

                        <div v-for="item in wishlist" :key="item.id" class="paper-card">
                            <div class="paper-title">{{ item.title }}</div>
                            <div class="paper-meta">
                                <span>üë§ {{ item.authors || 'N/A' }}</span>
                                <span>üìÖ {{ item.year || 'N/A' }}</span>
                                <span>üìñ {{ item.publication || 'N/A' }}</span>
                                <span>üìä Cited: {{ item.cited_by }}</span>
                            </div>
                            <div v-if="item.notes" style="margin-top: 10px; padding: 10px; background: white; border-radius: 8px;">
                                <strong>üìù Notes:</strong> {{ item.notes }}
                            </div>
                            <div class="paper-actions">
                                <button @click="removeFromWishlist(item.id)" class="btn btn-danger btn-sm">
                                    üóëÔ∏è Remove
                                </button>
                                <a v-if="item.scopus_url" :href="item.scopus_url" target="_blank" class="btn btn-primary btn-sm">
                                    üîó View on Scopus
                                </a>
                            </div>
                        </div>
                    </div>

                    <div v-show="activeSection === 'apikeys'" class="card">
                        <h3 class="card-title">üîë My API Keys</h3>
                        
                        <transition name="fade">
                            <div v-if="apikeysAlert.show" class="alert" :class="'alert-' + apikeysAlert.type">
                                {{ apikeysAlert.message }}
                            </div>
                        </transition>

                        <div class="alert alert-info">
                            <strong>‚ÑπÔ∏è Info:</strong> Add your Scopus API key to use the search feature. 
                            Get your API key from <a href="https://dev.elsevier.com/" target="_blank">Elsevier Developer Portal</a>.
                        </div>

                        <form @submit.prevent="addApiKey">
                            <div class="form-group">
                                <label class="form-label">Key Name</label>
                                <input type="text" v-model="apikeyForm.keyName" class="form-control" placeholder="e.g., My Scopus Key" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">API Key</label>
                                <input type="text" v-model="apikeyForm.apiKey" class="form-control" placeholder="Enter your Scopus API key" required>
                            </div>
                            <button type="submit" :disabled="apikeysLoading" class="btn btn-success">
                                <span v-if="!apikeysLoading">‚ûï Add API Key</span>
                                <span v-else>Adding...</span>
                            </button>
                        </form>

                        <div v-if="apikeysLoading" class="loading">
                            <div class="spinner"></div>
                            <p>Loading API keys...</p>
                        </div>

                        <div v-if="!apikeysLoading && apikeys.length === 0" style="margin-top: 30px;" class="empty-state">
                            <div class="empty-state-icon">üîë</div>
                            <div class="empty-state-text">No API keys yet</div>
                            <p>Add your first Scopus API key above</p>
                        </div>

                        <div style="margin-top: 30px;">
                            <div v-for="key in apikeys" :key="key.id" class="list-item">
                                <div class="list-item-content">
                                    <div class="list-item-title">
                                        {{ key.key_name }}
                                        <span class="badge" :class="key.is_active ? 'badge-success' : 'badge-secondary'">
                                            {{ key.is_active ? '‚úÖ Active' : '‚è∏Ô∏è Inactive' }}
                                        </span>
                                    </div>
                                    <div class="list-item-meta">
                                        Added: {{ new Date(key.created_at).toLocaleDateString() }}
                                    </div>
                                </div>
                                <button @click="deleteApiKey(key.id)" class="btn btn-danger btn-sm">
                                    üóëÔ∏è Delete
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </transition>
        </div>
    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    isAuthenticated: false,
                    user: null,
                    token: localStorage.getItem('token'),
                    authTab: 'login',
                    activeSection: 'search',
                    headerSubtitle: 'Login untuk mulai searching paper di Scopus',
                    authLoading: false,
                    searchLoading: false,
                    wishlistLoading: false,
                    apikeysLoading: false,
                    authAlert: { show: false, message: '', type: 'info' },
                    searchAlert: { show: false, message: '', type: 'info' },
                    wishlistAlert: { show: false, message: '', type: 'info' },
                    apikeysAlert: { show: false, message: '', type: 'info' },
                    loginForm: { email: '', password: '' },
                    registerForm: { email: '', password: '', confirmPassword: '' },
                    searchForm: { query: 'machine learning', limit: 25, yearFrom: '', yearTo: '', sortBy: '-citedby-count' },
                    apikeyForm: { keyName: '', apiKey: '' },
                    searchResults: [],
                    wishlist: [],
                    apikeys: [],
                    apiBase: window.location.origin
                }
            },
            
            mounted() {
                if (this.token) {
                    this.validateToken();
                }
            },
            
            methods: {
                showAlert(alertName, message, type = 'info', duration = 5000) {
                    this[alertName] = { show: true, message, type };
                    setTimeout(() => {
                        this[alertName].show = false;
                    }, duration);
                },
                
                async register() {
                    if (this.registerForm.password.length < 6) {
                        this.showAlert('authAlert', 'Password must be at least 6 characters', 'error');
                        return;
                    }
                    if (this.registerForm.password !== this.registerForm.confirmPassword) {
                        this.showAlert('authAlert', 'Passwords do not match', 'error');
                        return;
                    }
                    
                    this.authLoading = true;
                    try {
                        const response = await fetch(`${this.apiBase}/api/auth/register`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                email: this.registerForm.email,
                                password: this.registerForm.password
                            })
                        });
                        
                        const data = await response.json();
                        
                        if (response.ok) {
                            this.showAlert('authAlert', 'Registration successful! Please login.', 'success');
                            setTimeout(() => { this.authTab = 'login'; }, 2000);
                            this.registerForm = { email: '', password: '', confirmPassword: '' };
                        } else {
                            this.showAlert('authAlert', data.detail || 'Registration failed', 'error');
                        }
                    } catch (error) {
                        this.showAlert('authAlert', 'Network error: ' + error.message, 'error');
                    } finally {
                        this.authLoading = false;
                    }
                },
                
                async login() {
                    this.authLoading = true;
                    try {
                        const response = await fetch(`${this.apiBase}/api/auth/login`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                email: this.loginForm.email,
                                password: this.loginForm.password
                            })
                        });
                        
                        const data = await response.json();
                        
                        if (response.ok) {
                            this.token = data.access_token;
                            this.user = data.user;
                            localStorage.setItem('token', this.token);
                            localStorage.setItem('user', JSON.stringify(this.user));
                            this.isAuthenticated = true;
                            this.headerSubtitle = 'Search, Save, and Manage Your Papers';
                            this.showAlert('authAlert', 'Login successful!', 'success');
                            this.loginForm = { email: '', password: '' };
                            await this.loadApiKeys();
                        } else {
                            this.showAlert('authAlert', data.detail || 'Login failed', 'error');
                        }
                    } catch (error) {
                        this.showAlert('authAlert', 'Network error: ' + error.message, 'error');
                    } finally {
                        this.authLoading = false;
                    }
                },
                
                async validateToken() {
                    try {
                        const response = await fetch(`${this.apiBase}/api/auth/me`, {
                            headers: { 'Authorization': `Bearer ${this.token}` }
                        });
                        
                        if (response.ok) {
                            this.user = await response.json();
                            this.isAuthenticated = true;
                            this.headerSubtitle = 'Search, Save, and Manage Your Papers';
                            await this.loadApiKeys();
                        } else {
                            this.logout();
                        }
                    } catch (error) {
                        this.logout();
                    }
                },
                
                logout() {
                    this.token = null;
                    this.user = null;
                    this.isAuthenticated = false;
                    this.headerSubtitle = 'Login untuk mulai searching paper di Scopus';
                    localStorage.removeItem('token');
                    localStorage.removeItem('user');
                },
                
                switchSection(section) {
                    this.activeSection = section;
                    if (section === 'wishlist') this.loadWishlist();
                    if (section === 'apikeys') this.loadApiKeys();
                },
                
                async searchPapers() {
                    this.searchLoading = true;
                    this.searchResults = [];
                    
                    try {
                        const body = {
                            query: this.searchForm.query,
                            limit: this.searchForm.limit,
                            sort_by: this.searchForm.sortBy
                        };
                        
                        if (this.searchForm.yearFrom) body.year_from = this.searchForm.yearFrom;
                        if (this.searchForm.yearTo) body.year_to = this.searchForm.yearTo;
                        
                        const response = await fetch(`${this.apiBase}/api/search`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${this.token}`
                            },
                            body: JSON.stringify(body)
                        });
                        
                        const data = await response.json();
                        
                        if (response.ok) {
                            this.searchResults = data.papers;
                            this.showAlert('searchAlert', `Found ${data.returned_count} papers in ${data.execution_time.toFixed(2)}s`, 'success');
                        } else {
                            this.showAlert('searchAlert', data.detail || 'Search failed', 'error');
                        }
                    } catch (error) {
                        this.showAlert('searchAlert', 'Error: ' + error.message, 'error');
                    } finally {
                        this.searchLoading = false;
                    }
                },
                
                clearSearch() {
                    this.searchForm = { query: '', limit: 25, yearFrom: '', yearTo: '', sortBy: '-citedby-count' };
                    this.searchResults = [];
                    this.searchAlert.show = false;
                },
                
                async addToWishlist(paper) {
                    try {
                        const response = await fetch(`${this.apiBase}/api/wishlist/`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${this.token}`
                            },
                            body: JSON.stringify({
                                title: paper.title,
                                authors: paper.authors,
                                year: paper.year,
                                publication: paper.publication,
                                cited_by: paper.cited_by,
                                doi: paper.doi,
                                eid: paper.eid,
                                scopus_url: paper.scopus_url
                            })
                        });
                        
                        if (response.ok) {
                            this.showAlert('searchAlert', '‚úÖ Paper added to wishlist!', 'success');
                        } else {
                            const data = await response.json();
                            this.showAlert('searchAlert', data.detail || 'Failed to add to wishlist', 'error');
                        }
                    } catch (error) {
                        this.showAlert('searchAlert', 'Error: ' + error.message, 'error');
                    }
                },
                
                async loadWishlist() {
                    this.wishlistLoading = true;
                    try {
                        const response = await fetch(`${this.apiBase}/api/wishlist/`, {
                            headers: { 'Authorization': `Bearer ${this.token}` }
                        });
                        
                        if (response.ok) {
                            this.wishlist = await response.json();
                        } else {
                            this.showAlert('wishlistAlert', 'Failed to load wishlist', 'error');
                        }
                    } catch (error) {
                        this.showAlert('wishlistAlert', 'Error: ' + error.message, 'error');
                    } finally {
                        this.wishlistLoading = false;
                    }
                },
                
                async removeFromWishlist(itemId) {
                    if (!confirm('Remove this paper from wishlist?')) return;
                    
                    try {
                        const response = await fetch(`${this.apiBase}/api/wishlist/${itemId}`, {
                            method: 'DELETE',
                            headers: { 'Authorization': `Bearer ${this.token}` }
                        });
                        
                        if (response.ok) {
                            this.showAlert('wishlistAlert', 'Paper removed from wishlist', 'success');
                            await this.loadWishlist();
                        } else {
                            this.showAlert('wishlistAlert', 'Failed to remove paper', 'error');
                        }
                    } catch (error) {
                        this.showAlert('wishlistAlert', 'Error: ' + error.message, 'error');
                    }
                },
                
                async loadApiKeys() {
                    this.apikeysLoading = true;
                    try {
                        const response = await fetch(`${this.apiBase}/api/keys/`, {
                            headers: { 'Authorization': `Bearer ${this.token}` }
                        });
                        
                        if (response.ok) {
                            this.apikeys = await response.json();
                        } else {
                            this.showAlert('apikeysAlert', 'Failed to load API keys', 'error');
                        }
                    } catch (error) {
                        this.showAlert('apikeysAlert', 'Error: ' + error.message, 'error');
                    } finally {
                        this.apikeysLoading = false;
                    }
                },
                
                async addApiKey() {
                    this.apikeysLoading = true;
                    try {
                        const response = await fetch(`${this.apiBase}/api/keys/`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${this.token}`
                            },
                            body: JSON.stringify({
                                key_name: this.apikeyForm.keyName,
                                api_key: this.apikeyForm.apiKey
                            })
                        });
                        
                        if (response.ok) {
                            this.showAlert('apikeysAlert', 'API key added successfully!', 'success');
                            this.apikeyForm = { keyName: '', apiKey: '' };
                            await this.loadApiKeys();
                        } else {
                            const data = await response.json();
                            this.showAlert('apikeysAlert', data.detail || 'Failed to add API key', 'error');
                        }
                    } catch (error) {
                        this.showAlert('apikeysAlert', 'Error: ' + error.message, 'error');
                    } finally {
                        this.apikeysLoading = false;
                    }
                },
                
                async deleteApiKey(keyId) {
                    if (!confirm('Delete this API key?')) return;
                    
                    try {
                        const response = await fetch(`${this.apiBase}/api/keys/${keyId}`, {
                            method: 'DELETE',
                            headers: { 'Authorization': `Bearer ${this.token}` }
                        });
                        
                        if (response.ok) {
                            this.showAlert('apikeysAlert', 'API key deleted', 'success');
                            await this.loadApiKeys();
                        } else {
                            this.showAlert('apikeysAlert', 'Failed to delete API key', 'error');
                        }
                    } catch (error) {
                        this.showAlert('apikeysAlert', 'Error: ' + error.message, 'error');
                    }
                }
            }
        }).mount('#app');
    </script>
</body>
</html>
